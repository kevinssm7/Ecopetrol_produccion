@{
    ViewBag.Title = "TABLERO PUNTO DISPENSACIÓN";
    Layout = "~/Views/Shared/_LayoutECOPETROL.cshtml";
    var alerta = ViewBag.alerta;

}

<br />

<div class="container">
    <div class="row">
        <div class="col-sm-12" style="font-family:'Century Gothic'">
            @if (!String.IsNullOrEmpty(alerta))
            {

                if (alerta.Contains("CORRECTAMENTE"))
                {
                    <div class="alert alert-success">
                        <strong style="font-family:'Century Gothic'">Éxito!</strong> @alerta
                    </div>
                }
                else
                {
                    <div class="alert alert-danger">
                        <strong style="font-family:'Century Gothic'">Error!</strong> @alerta
                    </div>
                }
            }
        </div>
    </div>
</div>


<div class="container">
    <div class="panel panel-default">
        <div class="panel-heading">
            <strong class="text-primary_asalud">TABLERO PUNTO DISPENSACIÓN</strong>
        </div>

        <form id="divFiltro" method="post" action="TableroPuntoDispensacion" enctype="multipart/form-data">
            <div class="panel-body">
                <div class="col-md-3">
                    <label class="text-secondary_asalud">Periodo fecha inicio</label>
                    <input class="datepickerr disabled" style="width: 100%" name="fechaIni" id="fechaIni" />
                </div>
                <div class="col-md-3">
                    <label class="text-secondary_asalud">Periodo fecha final</label>
                    <input class="datepickerr disabled" style="width: 100%" name="fechaFin" id="fechaFin" />
                </div>

                <div class="col-md-3">
                    <label class="text-secondary_asalud">Regional</label>
                    <select class="form-control select2" style="width:100%" name="regional" id="regional">
                        <option value="">- Seleccione -</option>
                        @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_regional item in ViewBag.regional)
                        {
                            <option value="@item.indice">@item.nombre_regional</option>
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="text-secondary_asalud">Nit prestador</label>
                    <input type="text" autocomplete="off" class="form-control solo-numero" name="nitPrestador" id="nitPrestador" maxlength="100" />
                </div>
            </div>

            <div class="panel-body">
                <div class="col-md-3">
                    <label class="text-secondary_asalud">Prestador</label>
                    <input type="text" autocomplete="off" class="form-control" name="prestador" id="prestador" maxlength="100" />
                </div>
                <br />

                <div class="col-md-3">
                    <button type="submit" class="button_Asalud_Aceptar"><i class="glyphicon glyphicon-search" aria-hidden="true"></i> Buscar</button>
                </div>
            </div>
            <br />

            <div class="row">
            </div>
        </form>

        <div class="panel-body">
            <ul class="nav nav-pills" style="font-size: 12px">
                <li class="active" id="li1"><a href="#tab1" class="collapse1" data-toggle="tab">Por evaluar @ViewBag.conteoPendiente</a></li>
                <li id="li2"><a href="#tab2" class="collapse2" data-toggle="tab">Evaluadas @ViewBag.conteoEvaluadas</a></li>
                <li id="li3"><a href="#tab3" class="collapse3" data-toggle="tab">Construcción @ViewBag.conteoContruccion</a></li>
                <li id="li4"><a href="#tab4" class="collapse4" data-toggle="tab">Eliminadas @ViewBag.conteoEliminada</a></li>
                <li id="li5"><a href="#tab5" class="collapse5" data-toggle="tab">Canceladas @ViewBag.conteoCancelada</a></li>
                <li id="li6"><a href="#tab6" class="collapse5" data-toggle="tab">Para plan mejora @ViewBag.conteoPM</a></li>
            </ul>
        </div>
    </div>

    <div class="tab-content">
        <div class="tab-pane active" id="tab1">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="tableDatos1 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>ítem</th>
                                    <th>Prestador</th>
                                    <th>Dirección</th>
                                    <th>Teléfono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th>Evaluación</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var i = 0;
                                }

                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.listaPendiente)
                                {
                                    i++;
                                    <tr>
                                        <td>@i</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.direccion_punto_dispensacion</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>

                                        @if (item.fecha_nuevavisita != null)
                                        {
                                            <td>@item.fecha_nuevavisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }

                                        <td style="align-content:center; text-align:center;">
                                            @if (item.motivo == "CONTRATO FINALIZADO" || item.motivo == "CONTRATO FINALIZADO")
                                            {
                                                <label class="text-secondary_asalud" style="color:red;">CANCELADO</label>
                                            }
                                            else
                                            {
                                                @*<button class='button_Asalud_Aceptar' onclick="verificacionPrueba('@item.id_cargue_verificacion')">Evaluar</button>*@
                                                @*<button class='button_Asalud_Aceptar' onclick="IrEvaluacion('@item.id_cargue_verificacion')">Evaluar</button>*@

                                                <a role="button" class="btn button_Asalud_Aceptar btn-xs" href="javascript:IrEvaluacion(@item.id_cargue_verificacion)"><i class="glyphicon glyphicon-open"></i>&nbsp;Evaluar</a>
                                            }
                                        </td>
                                        <td style="align-content:center; text-align:center;">
                                            <a role="button" class="btn button_Asalud_Aceptar btn-xs" href="javascript:ActualizarVisita(@item.id_cargue_verificacion)"><i class="glyphicon glyphicon-pencil"></i>&nbsp;Actualizar</a>
                                        </td>
                                        <td style="align-content:center; text-align:center;">
                                            <a role="button" class="btn button_Asalud_Aceptar btn-xs" href="javascript:AñadirNovedad(@item.id_cargue_verificacion)"><i class="glyphicon glyphicon-inbox"></i>&nbsp;Novedades</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tab2">
            <div class="panel panel-default">
                <div class="col-md-12 text-right">
                    <a class="btn btn-sm button_Asalud_descargas" onclick="exportarExcelTo();" style="text-align:right;"><i class="glyphicon glyphicon-download"></i>&nbsp; Exportar reporte</a>
                </div>
                <br />
                <div class="panel-body">

                    <div class="table-responsive">
                        <table class="tableDatos2 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>Evaluación</th>
                                    <th>Prestador</th>
                                    <th>Telefono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Resultado general</th>
                                    <th>Condiciones locativas y dotación</th>
                                    <th>Recursos humanos</th>
                                    <th>Procesos generales</th>
                                    <th>Procesos especiales</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th>Repositorio</th>
                                    <th>Evaluación</th>
                                    <th>Exportables</th>
                                    <th>Acta</th>
                                    <th>Instrumento verificación</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.listaEvaluadas)
                                {
                                    <tr>
                                        <td>@item.id_evaluacion</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>
                                        <td>@item.resultado</td>
                                        <td>@item.condiciones_locativasDotacion</td>
                                        <td>@item.recurso_humano</td>
                                        <td>@item.procesos_generales</td>
                                        <td>@item.procesos_especiales</td>


                                        @if (item.fechaVisita != null)
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }
                                        <td>
                                            @if (item.existeArchivo == 1)
                                            {
                                                <a class="btn btn-xs button_Asalud_Aceptar" onclick="MostrarArchivos('@item.id_evaluacion')" data-toggle="modal" data-target="#modalRepositorio">
                                                    Archivos &nbsp; <i class="glyphicon glyphicon-file"></i>
                                                </a>
                                            }
                                            else
                                            {
                                                <label class="text-secondary_asalud">Sin archivos</label>
                                            }
                                        </td>

                                        <td>
                                            <a class='button_Asalud_Guardar' onclick="verEvalua('@item.id_cargue_verificacion', @item.id_evaluacion)">VER</a>
                                        </td>

                                        <td>
                                            <a class='button_Asalud_descargas' onclick="exportarExcelInd('@item.id_evaluacion')">EXCEL </a>
                                            &nbsp;
                                            <a class='button_Asalud_Guardar' onclick='pdfEvaluacion("@item.id_evaluacion");'>PDF</a>
                                        </td>

                                        <td>
                                            @if (item.existeActa == 1)
                                            {
                                                <a class="btn button_Asalud_Guardar btn-xs" style="margin:1%" role="button" href="javascript:abrirducumentoActa(@item.id_evaluacion)"><i class="glyphicon glyphicon-eye-open"></i>&nbsp; Ver acta de apertura y cierre </a>

                                                if (ViewBag.rol == "1")
                                                {
                                                    <a class="btn button_Asalud_Rechazar btn-xs" style="margin:1%" role="button" href="javascript:EliminarActa(@item.id_evaluacion)"><i class="glyphicon glyphicon-trash"></i>&nbsp; Eliminar acta </a>
                                                }
                                            }
                                            else
                                            {
                                                <a class="btn button_Asalud_Aceptar btn-xs" style="margin:1%" role="button" onclick="SubirDocumentoActa(@item.id_evaluacion)"><i class="glyphicon glyphicon-upload"></i>&nbsp;  Cargar acta de apertura y cierre </a>

                                            }
                                        </td>

                                        <td>
                                            @if (item.existeInstrumento == 1)
                                            {
                                                <a class="btn button_Asalud_Guardar btn-xs" style="margin:1%" role="button" href="javascript:abrirducumentoInstrumento(@item.id_evaluacion)"><i class="glyphicon glyphicon-eye-open"></i>&nbsp; Ver Instrumento de verificacion </a>

                                                if (ViewBag.rol == "1")
                                                {
                                                    <a class="btn button_Asalud_Rechazar btn-xs" style="margin:1%" role="button" href="javascript:EliminarInstrumento(@item.id_evaluacion)"><i class="glyphicon glyphicon-trash"></i>&nbsp; Eliminar instrumento de verificacion </a>
                                                }
                                            }
                                            else
                                            {
                                                <a class="btn button_Asalud_Aceptar btn-xs" style="margin:1%" role="button" onclick="SubirDocumentoInstrumento(@item.id_evaluacion)"><i class="glyphicon glyphicon-upload"></i>&nbsp;  Cargar Instrumento de verificacion </a>
                                            }

                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tab3">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="tableDatos3 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>Evaluación</th>
                                    <th>Prestador</th>
                                    <th>Telefono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Resultado general</th>
                                    <th>Condiciones locativas y dotación</th>
                                    <th>Recursos humanos</th>
                                    <th>Procesos generales</th>
                                    <th>Procesos especiales</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.listaContruccion)
                                {
                                    <tr>
                                        <td>@item.id_evaluacion</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>
                                        <td>@item.resultado</td>

                                        <td>@item.condiciones_locativasDotacion</td>
                                        <td>@item.recurso_humano</td>
                                        <td>@item.procesos_generales</td>
                                        <td>@item.procesos_especiales</td>

                                        @if (item.fechaVisita != null)
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }
                                        <td>

                                            <a class='button_Asalud_Guardar' onclick="continuar('@item.id_cargue_verificacion', '@item.id_evaluacion')">CONTINUAR</a>
                                        </td>
                                        <td>
                                            <a class='button_Asalud_Rechazar' onclick="EliminarAutoguardada('@item.id_evaluacion')">ELIMINAR</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tab4">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="tableDatos4 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>Ítem</th>
                                    <th>Prestador</th>
                                    <th>Telefono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Resultado general</th>
                                    <th>Condiciones locativas y dotación</th>
                                    <th>Recursos humanos</th>
                                    <th>Procesos generales</th>
                                    <th>Procesos especiales</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th>Observación eliminación</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.listaEliminada)
                                {
                                    <tr>
                                        <td>@item.id_dispensacion</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>
                                        <td>@item.resultado</td>

                                        <td>@item.condiciones_locativasDotacion</td>
                                        <td>@item.recurso_humano</td>
                                        <td>@item.procesos_generales</td>
                                        <td>@item.procesos_especiales</td>

                                        @if (item.fechaVisita != null)
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }
                                        <td>
                                            @item.observacion_cancela_elimina
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tab5">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="tableDatos5 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>Ítem</th>
                                    <th>Prestador</th>
                                    <th>Telefono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Resultado general</th>
                                    <th>Condiciones locativas y dotación</th>
                                    <th>Recursos humanos</th>
                                    <th>Procesos generales</th>
                                    <th>Procesos especiales</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th>Observación cancelación</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.istaCancelada)
                                {
                                    <tr>
                                        <td>@item.id_dispensacion</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>
                                        <td>@item.resultado</td>
                                        <td>@item.condiciones_locativasDotacion</td>
                                        <td>@item.recurso_humano</td>
                                        <td>@item.procesos_generales</td>
                                        <td>@item.procesos_especiales</td>

                                        @if (item.fechaVisita != null)
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }
                                        <td>
                                            @item.observacion_cancela_elimina
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tab6">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="tableDatos6 table table-bordered table-condensed" style="font-size:10px; width:98%;">
                            <thead>
                                <tr>
                                    <th>Evaluación</th>
                                    <th>Prestador</th>
                                    <th>Telefono contacto</th>
                                    <th>Ciudad</th>
                                    <th>Regional</th>
                                    <th>Farmacia</th>
                                    <th>Resultado general</th>
                                    <th>Condiciones locativas y dotación</th>
                                    <th>Recursos humanos</th>
                                    <th>Procesos generales</th>
                                    <th>Procesos especiales</th>
                                    <th>Fecha verificación</th>
                                    <th>Auditor</th>
                                    <th>Ver</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (ECOPETROL_COMMON.ENTIDADES.management_dispensacion_evaluacionRelacionResult item in ViewBag.listaPM)
                                {
                                    <tr>
                                        <td>@item.id_evaluacion</td>
                                        <td>@item.nit_prestador - @item.nombre_prestador</td>
                                        <td>@item.contacto_telefonico</td>
                                        <td>@item.ciudad</td>
                                        <td>@item.regional</td>
                                        <td>@item.nombre_farmacia</td>
                                        <td>@item.resultado</td>

                                        <td>@item.condiciones_locativasDotacion</td>
                                        <td>@item.recurso_humano</td>
                                        <td>@item.procesos_generales</td>
                                        <td>@item.procesos_especiales</td>

                                        @if (item.fechaVisita != null)
                                        {
                                            <td>@item.fechaVisita.Value.ToString("dd/MM/yyyy")</td>
                                        }
                                        else
                                        {
                                            <td>@item.fechaVisita</td>
                                        }

                                        @if (!string.IsNullOrEmpty(item.auditor_nuevo))
                                        {
                                            <td>@item.auditor_nuevo</td>
                                        }
                                        else
                                        {
                                            <td>@item.auditor_asignado</td>
                                        }

                                        <td>
                                            <a class='btn button_Asalud_Guardar btn-sm' onclick="verEvalua('@item.id_cargue_verificacion', @item.id_evaluacion)">VER</a>
                                        </td>

                                        <td>

                                            <a class='btn button_Asalud_Guardar btn-sm ' onclick="aPlanMejora('@item.id_evaluacion')">ENVIAR A PLAN MEJORA</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" data-keyboard="false" id="modalGestion">
    <div class="modal-dialog modal-lg" style="width:35%">
        <div class="modal-content">

            <div class="modal-body">
                <div id="resultadoG"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" data-keyboard="false" id="modalNovedad">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div id="resultadoNovedad"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="mi-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title asalud" id="myModalLabel">Confirmar</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                <label class="text-secondary_asalud">¿Realizar evaluación?</label>
                <input type="hidden" id="idPunto" name="idPunto" />
                <br />
                <button type="button" class="btn button_Asalud_Aceptar" id="modal-btn-si">Si</button>
                <button type="button" class="btn button_Asalud_Rechazar" id="modal-btn-no">No</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn button_Asalud_Rechazar" id="modal-btn-can">Cancelar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" data-keyboard="false" id="modalRepositorio">
    <div class="modal-dialog modal-lg" style="width:70%">
        <div class="modal-content">

            <div class="modal-body">
                <div id="resultadoArchi"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="button_Asalud_Rechazar" onclick="GestionCerrar()">CERRAR</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="ModalDocumentoActa" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formularioActa" name="formularioActa">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="titlemodal">Cargar acta</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input type="hidden" id="idEValuacionActa" name="idEValuacionActa" />
                        <div class="col-sm-12">
                            <label class="text-secondary_asalud">Subir documento:</label>
                            <input type="file" class="form-control" id="fileActa" onchange="ValidacionArchivoActa()" required name="fileActa" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn button_Asalud_Guardar" type="button" onclick="CargarActa()">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="modal fade" id="ModalDocumentoInstrumento" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formularioinstrumento" name="formularioinstrumento">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="titlemodal">Cargar instrumento verificación</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input type="hidden" id="idEvaluacionInstrumento" name="idEvaluacionInstrumento" />
                        <div class="col-sm-12">
                            <label class="text-secondary_asalud">Subir documento:</label>
                            <input type="file" class="form-control" id="fileInstrumento" onchange="ValidacionArchivoInforme()" required name="fileInstrumento" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn button_Asalud_Guardar" type="button" onclick="CargarInstrumento()">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script src="~/Scripts/validate.js"></script>
<script src="httpS://code.jquery.com/ui/1.11.3/jquery-ui.js"></script>

<script>

    $(document).ready(function () {

        $('.select2').select2({
            width: '100%'
        });

        $(".datepickerr").kendoDatePicker({
            format: "MM/dd/yyyy",
        });

        $(".k-input").attr('readonly', true);

        $("#prestador").autocomplete({
            source: "/Verificacion/Buscar_NombrePrestador",
            type: "POST",
            dataType: "json",
            minLenght: 0,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nombre);
                }
            }
        });

        $("#nitPrestador").autocomplete({
            source: "/Verificacion/Buscar_codigoPrestador",
            type: "POST",
            dataType: "json",
            minLenght: 4,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nit);
                }
            }
        });

        $("#prestadorM").autocomplete({
            source: "/Verificacion/Buscar_NombrePrestador",
            type: "POST",
            dataType: "json",
            minLenght: 0,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nombre);
                }
            }
        });

        $("#nitPrestadorM").autocomplete({
            source: "/Verificacion/Buscar_codigoPrestador",
            type: "POST",
            dataType: "json",
            minLenght: 4,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nit);
                }
            }
        });

        $("#prestadorC").autocomplete({
            source: "/Verificacion/Buscar_NombrePrestador",
            type: "POST",
            dataType: "json",
            minLenght: 0,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nombre);
                }
            }
        });

        $("#nitPrestadorC").autocomplete({
            source: "/Verificacion/Buscar_codigoPrestador",
            type: "POST",
            dataType: "json",
            minLenght: 4,
            change: function (evento, ui) {
                if (ui.item != null) {
                    $(this).val(ui.item.nit);
                }
            }
        });

        $("ul.nav.nav-pills li a").on('shown.bs.tab', function (e) {

            setTimeout(function () {

                var tab1 = $("#tab" + 1).hasClass("active");
                var tab2 = $("#tab" + 2).hasClass("active");
                var tab3 = $("#tab" + 3).hasClass("active");
                var tab4 = $("#tab" + 4).hasClass("active");
                var tab5 = $("#tab" + 5).hasClass("active");

                if (tab1) {
                    MostrarTablaPendientes();
                }

                if (tab2) {
                    MostrarTablaEvaluadas();
                }

                if (tab3) {
                    MostrarTablaConstruccion();
                }

                if (tab4) {
                    MostrarTablaEliminadas();
                }

                if (tab5) {
                    MostrarTablasCanceladas();
                }

            }, 100);
        });

        MostrarTablaPendientes();
    });

    function MostrarTablaPendientes() {
        var conteoTotal = '@ViewBag.conteoPendiente';

        if (conteoTotal > 0) {

            $('.tableDatos1').DataTable().destroy();
            $('.tableDatos1').DataTable({
                "searching": true,
                "aLengthMenu": [[10, 30, 200, 500, 1000, 5000, -1], [10, 30, 200, 500, 1000, 5000, "Todos"]],
                "iDisplayLength": 10,
                "lengthchange": false,
                "info": false,
                "responsive": true,
                "zeroRecords": "No se encontraron resultados",
                responsive: true,
                language: {
                    sLengthMenu: "Ver _MENU_ registros",
                    processing: "Procesando...",
                    search: "Buscar:",
                    lengthmenu: "Mostrar menu registros",
                    info: "Mostrando registros del start al end de un total de total registros",
                    infoempty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                    infofiltered: "(Filtrado de un total de max registros)",
                    loadingrecords: "Cargando...",
                    zerorecords: "No se encontraron resultados",
                    emptytable: "Ningún dato disponible en esta tabla",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo",
                    },
                }
            });
        }
    }

    function MostrarTablaEvaluadas() {
        var conteoTotal = '@ViewBag.conteoEvaluadas';

        if (conteoTotal > 0) {

            $('.tableDatos2').DataTable().destroy();
            $('.tableDatos2').DataTable({
                "searching": true,
                "aLengthMenu": [[10, 30, 200, 500, 1000, 5000, -1], [10, 30, 200, 500, 1000, 5000, "Todos"]],
                "iDisplayLength": 10,
                "lengthchange": false,
                "info": false,
                "responsive": true,
                "zeroRecords": "No se encontraron resultados",
                responsive: true,
                language: {
                    sLengthMenu: "Ver _MENU_ registros",
                    processing: "Procesando...",
                    search: "Buscar:",
                    lengthmenu: "Mostrar menu registros",
                    info: "Mostrando registros del start al end de un total de total registros",
                    infoempty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                    infofiltered: "(Filtrado de un total de max registros)",
                    loadingrecords: "Cargando...",
                    zerorecords: "No se encontraron resultados",
                    emptytable: "Ningún dato disponible en esta tabla",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo",
                    },
                }
            });
        }
    }

    function MostrarTablaConstruccion() {
        var conteoTotal = '@ViewBag.conteoContruccion';

        if (conteoTotal > 0) {

            $('.tableDatos3').DataTable().destroy();
            $('.tableDatos3').DataTable({
                "searching": true,
                "aLengthMenu": [[10, 30, 200, 500, 1000, 5000, -1], [10, 30, 200, 500, 1000, 5000, "Todos"]],
                "iDisplayLength": 10,
                "lengthchange": false,
                "info": false,
                "responsive": true,
                "zeroRecords": "No se encontraron resultados",
                responsive: true,
                language: {
                    sLengthMenu: "Ver _MENU_ registros",
                    processing: "Procesando...",
                    search: "Buscar:",
                    lengthmenu: "Mostrar menu registros",
                    info: "Mostrando registros del start al end de un total de total registros",
                    infoempty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                    infofiltered: "(Filtrado de un total de max registros)",
                    loadingrecords: "Cargando...",
                    zerorecords: "No se encontraron resultados",
                    emptytable: "Ningún dato disponible en esta tabla",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo",
                    },
                }
            });
        }
    }

    function MostrarTablaEliminadas() {
        var conteoTotal = '@ViewBag.conteoEliminada';

        if (conteoTotal > 0) {

            $('.tableDatos4').DataTable().destroy();
            $('.tableDatos4').DataTable({
                "searching": true,
                "aLengthMenu": [[10, 30, 200, 500, 1000, 5000, -1], [10, 30, 200, 500, 1000, 5000, "Todos"]],
                "iDisplayLength": 10,
                "lengthchange": false,
                "info": false,
                "responsive": true,
                "zeroRecords": "No se encontraron resultados",
                responsive: true,
                language: {
                    sLengthMenu: "Ver _MENU_ registros",
                    processing: "Procesando...",
                    search: "Buscar:",
                    lengthmenu: "Mostrar menu registros",
                    info: "Mostrando registros del start al end de un total de total registros",
                    infoempty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                    infofiltered: "(Filtrado de un total de max registros)",
                    loadingrecords: "Cargando...",
                    zerorecords: "No se encontraron resultados",
                    emptytable: "Ningún dato disponible en esta tabla",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo",
                    },
                }
            });
        }
    }

    function MostrarTablasCanceladas() {
        var conteoTotal = '@ViewBag.conteoCancelada';

        if (conteoTotal > 0) {

            $('.tableDatos5').DataTable().destroy();
            $('.tableDatos5').DataTable({
                "searching": true,
                "aLengthMenu": [[10, 30, 200, 500, 1000, 5000, -1], [10, 30, 200, 500, 1000, 5000, "Todos"]],
                "iDisplayLength": 10,
                "lengthchange": false,
                "info": false,
                "responsive": true,
                "zeroRecords": "No se encontraron resultados",
                responsive: true,
                language: {
                    sLengthMenu: "Ver _MENU_ registros",
                    processing: "Procesando...",
                    search: "Buscar:",
                    lengthmenu: "Mostrar menu registros",
                    info: "Mostrando registros del start al end de un total de total registros",
                    infoempty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                    infofiltered: "(Filtrado de un total de max registros)",
                    loadingrecords: "Cargando...",
                    zerorecords: "No se encontraron resultados",
                    emptytable: "Ningún dato disponible en esta tabla",
                    paginate: {
                        first: "Primero",
                        previous: "Anterior",
                        next: "Siguiente",
                        last: "Ultimo",
                    },
                }
            });
        }
    }

    function RealizadaExcel(id) {

        location.href = "@Url.Action("ExcelExportar", "Verificacion")?id=" + id;
    }

    function verValidacion(idPunto) {
        location.href = "@Url.Action("EvaluacionDispensacion", "Verificacion")?idPunto=" + idPunto;
    }

    function ModaGestion(id) {

        var idVerificacion = id;
        var laUrl = '@Url.Action("_ModalGestion")?idVerificacion=' + idVerificacion ;
        $.ajax({
            cache: false,
            async: true,
            type: "GET",
            url: laUrl,
            data: {},
            success: function (response) {
                $("#myModalTarea").modal('show');
                $('#resultadoTarea').html('');
                $('#resultadoTarea').html(response);
            }
        });
    }

    function MostrarTabla(id) {
        $('.tableDatos' + id).DataTable().destroy();
        $('.tableDatos' + id).DataTable({
            "searching": true,
            "idisplaylength": 15,
            "lengthchange": false,
            "info": false,
            responsive: true,
            language: {
                processing: "procesando...",
                search: "Buscar:",
                lengthmenu: "mostrar menu registros",
                info: "mostrando registros del start al end de un total de total registros",
                infoempty: "mostrando registros del 0 al 0 de un total de 0 registros",
                infofiltered: "(filtrado de un total de max registros)",
                infopostfix: "",
                loadingrecords: "cargando...",
                zerorecords: "no se encontraron resultados",
                emptytable: "ningún dato disponible en esta tabla",
                paginate: {
                    first: "primero",
                    previous: "anterior",
                    next: "siguiente",
                    last: "último",
                },
            }
        });
    }

    function verTablero(tipo) {

        var fechaIni = $("#fechaIni").val();
        var fechaFin = $("#fechaFin").val();
        var regional = $("#regional").val();
        var prestador = $("#prestador").val();
        var nitPrestador = $("#nitPrestador").val();

        $.ajax({
            url: "@Url.Action("TableroPuntoDispensacionDatos")",
            type: "post",
            data: {
                regional: regional,
                fechaIni: fechaIni,
                fechaFin: fechaFin,
                prestador: prestador,
                nitPrestador: nitPrestador,
                tipo: tipo
            },
            success: function (data) {
                var Particion = data.split("|");
                var tabla = Particion[0];
                var conteo = Particion[1];

                $("#tabla1 tbody").empty();
                $("#tabla1 tbody").html(tabla);
                $("#conteo").val(conteo);

                MostrarTabla(1);
            }
        })
    }

    function verificacionPrueba(id) {
        $("#mi-modal").modal('show');
        document.getElementById("idPunto").value = id;
    }

    $("#modal-btn-si").on("click", function () {
        LoadingShow();

        $("#mi-modal").modal('hide');
        var idPunto = document.getElementById("idPunto").value;
        location.href = "@Url.Action("EvaluacionDispensacion", "Verificacion")?idPunto=" + idPunto;
        LoadingHide();
    });

    $("#modal-btn-no").on("click", function () {
        $("#mi-modal").modal('hide');
        var idPunto = document.getElementById("idPunto").value;
        var laUrl = "@Url.Action("_ModalGestion", "Verificacion")";
        $.ajax({
            cache: false,
            async: true,
            type: "GET",
            url: laUrl,
            data: {
                idVerificacion: idPunto
            },
            success: function (response) {

                $("#modalGestion").modal('show');
                $('#resultadoG').html('');
                $('#resultadoG').html(response);
            }
        })
    });

    $("#modal-btn-can").on("click", function () {
        $("#mi-modal").modal('hide');
    });

    function IrEvaluacion(idPunto) {
        var confirma = confirm("¿Seguro(a) de empezar esta evaluación?");
        if (confirma == true) {
            location.href = "@Url.Action("EvaluacionDispensacion", "Verificacion")?idPunto=" + idPunto;
        }
    }

    function ActualizarVisita(idPunto) {
        $.ajax({
            cache: false,
            async: true,
            type: "GET",
            url: "@Url.Action("_ModalGestion", "Verificacion")",
            data: {
                idVerificacion: idPunto
            },
            success: function (response) {
                $("#modalGestion").modal('show');
                $('#resultadoG').html('');
                $('#resultadoG').html(response);
            }
        })

    }

    function AñadirNovedad(idPunto) {
        $.ajax({
            cache: false,
            async: true,
            type: "GET",
            url: "@Url.Action("_ModalGestionEliminarCancelar", "Verificacion")",
            data: {
                idVerificacion: idPunto
            },
            success: function (response) {
                $("#modalNovedad").modal('show');
                $('#resultadoNovedad').html('');
                $('#resultadoNovedad').html(response);
            }
        })

    }

    function GestionCerrar() {
        $("#modalGestion").modal("hide");
    }

    function GestionCerrarRepositorio() {
        $("#modalRepositorio").modal("hide");
    }

    function MostrarArchivos(idEvaluacion) {

        var laUrl = "@Url.Action("_modalEvaluacionRepositorio", "Verificacion")";
        $.ajax({
            cache: false,
            async: true,
            type: "GET",
            url: laUrl,
            data: {
                idEvaluacion: idEvaluacion
            },
            success: function (response) {

                $('#resultadoArchi').empty();
                $('#resultadoArchi').html(response);
            }
        })
    }

    function verEvalua(idPunto, idEvaluacion) {
        location.href = "@Url.Action("EvaluacionDispensacion", "Verificacion")?idPunto=" + idPunto + "&tipo=" + 1 + "&idEvaluacion=" + idEvaluacion;
    }

    function exportarExcelInd(id) {
        location.href = "@Url.Action("ExcelExportarIndividual", "Verificacion")?id=" + id;
    }

    function exportarExcelTo() {
        location.href = "@Url.Action("ExcelExportarTotal", "Verificacion")";
    }

    function pdfEvaluacion(idEvaluacion) {
        var url = "@Url.Action("TraerPdf", "Verificacion")?idEvaluacion=" + idEvaluacion;
        opupWindow = window.open(url, '', 'height=500,width=700,left=50,top=50,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');
    }

    function MostrarModal(idEvaluacion) {
        alert(idEvaluacion);
    }

    function continuar(idPunto, idEvaluacion) {
        LoadingShow();
        location.href = "@Url.Action("EvaluacionDispensacion", "Verificacion")?idPunto=" + idPunto + "&tipo=" + 2 + "&idEvaluacion=" + idEvaluacion;
        LoadingHide();
    }

    function EliminarAutoguardada(id) {

        var confirmacion = confirm("¿Seguro de eliminar esta evaluación?");

        if (confirmacion) {

            $.ajax({
                url: "@Url.Action("EliminarVisitaAutoGuardada")",
                type: "post",
                data: {
                    idEvaluacion: id
                },
                method: "post",
                success: function (data) {
                    alert(data.mensaje);
                    location.reload();
                }
            });
        }
    }

    function SubirDocumentoActa(idEvaluacion) {
        $("#idEValuacionActa").val(idEvaluacion);
        $("#ModalDocumentoActa").modal('show');
    }

    function ValidacionArchivoActa() {
        var fileInput = document.getElementById('fileActa');
        var filePath = fileInput.value;
        var allowedExtensions = /(.pdf)$/i;
        if (!allowedExtensions.exec(filePath)) {
            alert('Por favor, solo subir archivos que contengan la extension .pdf');
            fileInput.value = '';
            return false;
        } else {
            return true
        }
    }

    function CargarActa() {

        var valida = $("#formularioActa").validate();
        if (valida.form()) {

            var formData = new FormData();
            formData.append('archivoActa', $('#fileActa')[0].files[0]);
            formData.append('idEvaluacion', $("#idEValuacionActa").val());

            LoadingShow();

            $.ajax({
                url: "@Url.Action("GuardarActaEvaluacion", "Verificacion")",
                type: "post",
                contentType: false,
                processData: false,
                data: formData,
                success: function (data) {
                    alert(data.mensaje);
                    LoadingHide();

                    if (data.rta == 1) {
                        location.reload();
                    }
                }
            });
        }
    }

    function abrirducumentoActa(idEvaluacion) {
           var url = "@Url.Action("VerActaEvaluacion", "Verificacion")?idEvaluacion=" + idEvaluacion
        popupWindow = window.open(url, '', 'height=150,width=500,left=50,top=550,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes')
    }

    function EliminarActa(idEvaluacion) {
        var mensaje = confirm("¿Seguro(a) de eliminar esta acta?");
        if (mensaje == true) {
            LoadingShow();
            $.ajax({
                url: "@Url.Action("EliminarActaVisitas")",
                type: "post",
                data: {
                    idEvaluacion: idEvaluacion
                },
                success: function (data) {
                    alert(data.mensaje);
                    LoadingHide();
                    if (data.rta == 1) {
                        location.reload();
                    }
                }
            });
        }
    }

    function SubirDocumentoInstrumento(idEvaluacion) {
        $("#idEvaluacionInstrumento").val(idEvaluacion);
        $("#ModalDocumentoInstrumento").modal('show');
    }

    function ValidacionArchivoInstrumento() {
        var fileInput = document.getElementById('fileInstrumento');
        var filePath = fileInput.value;
        var allowedExtensions = /(.pdf)$/i;
        if (!allowedExtensions.exec(filePath)) {
            alert('Por favor, solo subir archivos que contengan la extension .pdf');
            fileInput.value = '';
            return false;
        } else {
            return true
        }
    }

    function CargarInstrumento() {

        var valida = $("#formularioinstrumento").validate();
        if (valida.form()) {

            var formData = new FormData();
            formData.append('archivoInstrumento', $('#fileInstrumento')[0].files[0]);
            formData.append('idEvaluacionInstrumento', $("#idEvaluacionInstrumento").val());

            LoadingShow();

            $.ajax({
                url: "@Url.Action("GuardarInstrumentoEvaluacion", "Verificacion")",
                type: "post",
                contentType: false,
                processData: false,
                data: formData,
                success: function (data) {
                    alert(data.mensaje);
                    LoadingHide();

                    if (data.rta == 1) {
                        location.reload();
                    }
                }
            });
        }
    }

    function abrirducumentoInstrumento(idEvaluacion) {
           var url = "@Url.Action("VerInstrumentoEvaluacion", "Verificacion")?idEvaluacion=" + idEvaluacion
        popupWindow = window.open(url, '', 'height=150,width=500,left=50,top=550,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes')
    }

    function EliminarInstrumento(idEvaluacion) {
        var mensaje = confirm("¿Seguro(a) de eliminar esta instrumento verificación?");
        if (mensaje == true) {
            LoadingShow();
            $.ajax({
                url: "@Url.Action("EliminarInstrumentoVerificacionVisitas")",
                type: "post",
                data: {
                    idEvaluacion: idEvaluacion
                },
                success: function (data) {
                    alert(data.mensaje);
                    LoadingHide();
                    if (data.rta == 1) {
                        location.reload();
                    }
                }
            });
        }
    }

    function exportarExcelTotal(idEvaluacion) {
        location.href = "@Url.Action("ExcelExportarTotalHallazgoIdEvalu", "Verificacion")?idEvaluacion=" + idEvaluacion;
    }

    function aPlanMejora(idevaluacion) {
        var confirmar = confirm("¿Enviar la visita a planes de mejora?");
        if (confirmar == true) {
            location.href = "@Url.Action("IngresoCaracterización", "PlanMejora")?idVisitaDis=" + idevaluacion;
        }
    }

    function taberoPlanMejora() {
        location.href = "@Url.Action("TableroControlPlanMejora", "PlanMejora")";
    }

    function exportarExcelEvaluadas() {
        location.href = "@Url.Action("ExcelExportarTotalHallazgo", "Verificacion")";
    }

</script>


<style>
    table {
        font-family: "Century Gothic", "Century Gothic", Sans-Serif;
        font-size: 12px;
        margin: 10px;
        width: 500px;
        text-align: left;
        border-collapse: collapse;
    }

    th {
        font-weight: bold;
        padding: 8px;
        background: #636363;
        border-top: 4px solid #aabcfe;
        border-bottom: 1px solid #fff;
        color: #e8e8e8;
    }

    td {
        padding: 8px;
        background: #efefef;
        border-bottom: 2px solid #fff;
        color: #636363;
        border-top: 1px solid transparent;
    }

    tr:hover td {
        background: #bcbcbc;
        color: #1c1c1c;
    }

    .control-label {
        font-size: 15px;
        color: #357ebd;
    }


    .Info {
        color: #800000;
        text-align: justify;
        font-weight: bold;
    }

    .error {
        color: indianred;
        font-size: 13px;
        position: relative;
        margin-top: 10px;
    }

    .Tamaño {
        height: 200px;
    }

    .TamañoImag {
        height: 200px;
        position: center;
    }

    .TamañoDiv {
        position: page;
        /*width:1100px;*/
    }

    .btn-glyphicon {
        padding: 8px;
        background: #ffffff;
        margin-right: 4px;
    }

    .icon-btn {
        padding: 1px 15px 3px 2px;
        border-radius: 50px;
    }

    .text-secondary_asalud {
        font-family: "Century Gothic", "Century Gothic", Sans-Serif;
        color: #556da2;
    }

    .nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus {
        color: #fff;
        background-color: #556da2;
        font-family: "Century Gothic", "Century Gothic", Sans-Serif;
    }

    .nav {
        padding-left: 10px;
    }
</style>
